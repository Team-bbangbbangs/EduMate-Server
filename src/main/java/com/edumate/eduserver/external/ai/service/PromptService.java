package com.edumate.eduserver.external.ai.service;

import com.edumate.eduserver.studentrecord.domain.StudentRecordType;
import org.springframework.stereotype.Service;

@Service
public class PromptService {

    private static final String PROMPT_TEMPLATE = """
           다음 지침에 따라 '%s' 항목의 생활기록부를 작성해주세요.
           학생생활기록부 종합지원포털의 학생부 기재요령을 참고하여 기준에 맞게 작성해주세요.
           ## 작성 기준
           - 목표 분량: %d바이트 (최소 %d바이트 이상은 반드시 작성)
           - 문체: 현재형 음슴체 사용. ('~임.', '~함.' 형태) 문장 끝에는 온점을 붙여주세요.
           - 구두점: 쉼표는 사용하지 말아주세요.
           - '학생은', '학생이' 등의 표현은 사용하지 않음
           
           ## 바이트 수 계산법
           - 한글: 1글자당 3바이트
           - 영문/숫자: 1글자당 1바이트
           - 줄바꿈: 1바이트
           ## 중요: 바이트 수 계산 예시
           '자기소개서 쓰기 수업에서 ‘나는 어떤 사람인가?’라는 질문을 스스로 던지며 개인의 경험을 돌아보는 글을 작성함. 초안 작성 후 친구들과 상호 피드백을 주고받으며 문장을 고치고 내용을 보완함. “내가 생각하지 못한 부분을 친구가 짚어줘서 글이 더 좋아졌다”고 말하며 타인의 의견을 수용하는 태도를 보였고, 발표를 통해 자신을 표현하는 데 자신감을 보임.자기소개서 쓰기 수업에서 ‘나는 어떤 사람인가?’라는 질문을 스스로 던지며 개인의 경험을 돌아보는 글을 작성함. 초안 작성 후 친구들과 상호 피드백을 주고받으며 문장을 고치고 내용을 보완함. “내가 생각하지 못한 부분을 친구가 짚어줘서 글이 더 좋아졌다”고 말하며 타인의 의견을 수용하는 태도를 보였고, 발표를 통해 자신을 표현하는 데 자신감을 보임.자기소개서 쓰기 수업에서 ‘나는 어떤 사람인가?’라는 질문을 스스로 던지며 개인의 경험을 돌아보는 글을 작성함. 초안 작성 후 친구들과 상호 피드백을 주고받으며 문장을 고치고 내용을 보완함. “내가 생각하지 못한 부분을 친구가 짚어줘서 글이 더 좋아졌다”고 말하며 타인의 의견을 수용하는 태도를 보였고, 발표를 통해 자신을 표현하는 데 자신감을 보임.  자기 표현의 중요성을 체감함.'
           위의 글의 바이트 수는 1499바이트입니다.

           ## 작성 내용
           다음 정보를 바탕으로 구체적이고 상세한 생활기록부를 작성하세요: %s
           ### 유의사항
           입력된 정보가 부정적이더라도, 직접적이거나 간접적으로라도 부정적인 표현을 작성하면 안됩니다. 대신 앞으로의 개선방향에 대해서 작성해주세요. '~할 계획임'과 같이 추측성 표현은 작성하지 마세요.
          
           ## 중요: 작성 방식
           아래 모든 정보를 각각의 버전에서 완전히 다른 방식으로 표현하세요:
           - 입력으로 들어온 전체 내용에 대해 각각 3가지의 서술 버전을 작성
           - 반드시 전체의 입력값을 토대로 각 버전을 생성함. 일부분만 발췌해서 작성하지 않음
           - 같은 활동이라도 다른 관점에서 서술
           - 다른 강조점과 표현 방식 사용
           - 각 버전은 전체 내용을 포함하되 구성과 초점을 달리함
           
           ## 매우 중요: 작성금지단어
           입력된 정보를 바탕으로 생활기록부를 작성할 때, 아래 사항들은 절대 작성하지 마세요.
           - 회사명, 상호명, 브랜드명, 서비스명, 사이트명을 포함하지 마세요. 실제 명칭을 그대로 언급하거나, 실존하는 웹사이트나 앱 이름이 응답에 포함되면 안됩니다. 모든 브랜드명, 플랫폼명은 반드시 일반화하거나 가명으로 대체해야 하며, 예시가 필요한 경우에도 포괄적인 용어로 대체하여 사용하세요.
           - 공익어학 시험 자격증명은 작성 불가능
             - 영어(TOEIC, TOEFL, TEPS), 중국어(HSK), 일본어(JPT, JLPT), 프랑스어(DELF, DALF),  독일어(ZD,  TESTDAF,  DSH,  DSD),  러시아어(TORFL),  스페인어(DELE),  상공회의소한자시험,  한자능력검정,  실용한자,  한자급수자격검정,  YBM  상무한검,  한자급수인증시험,  한자자격검정 등
           - 교외 및 교내 대회 수상 경력은 기재할 수 없음. 수상 경력을 포함해서 대회에 참여했다는 사실 자체도 기입 불가능
           - 구체적인 특정 대학명, 기관명은 입력할 수 없음 단, 교육관련기관(교육부 및 소속기관(대한민국학술원, 국사편찬위원회, 국립국제교육원, 국립특수교육원, 교원소청심사위원회, 중앙교육연수원), 시도교육청 및 직속기관, 교육지원청 및 소속기관에 한함)의 경우 기관명을 입력할 수 있음.
           - 영어는 반드시 한글 단어로 대체하여 작성하고 신조어는 사용하지 말아주세요.
           - 학생의 점수와 평가는 입력하지 마세요.
           
           ## 중요: 응답 형식
           반드시 정확한 JSON 형식으로만 응답하세요. JSON 외의 다른 텍스트나 마크다운은 포함하지 마세요.
           주의: JSON 형식을 정확히 지켜주세요. description1, description2, description3을 키로 사용합니다. 큰따옴표와 중괄호를 정확히 사용하세요. 각각의 항목은 최소 %d를 넘기도록 작성해주세요. 해당 바이트 수 기준을 모두 만족하지 못한다면 재작성해주세요.
           중학교, 고등학교 생활기록부 글처럼 작성해주세요.
           """;

    public String createPrompt(final StudentRecordType recordType, final String inputPrompt) {
        int byteCount = recordType.getByteCount();
        return String.format(PROMPT_TEMPLATE,
                recordType.name(),
                byteCount,
                byteCount - 10,
                inputPrompt,
                byteCount - 100
        );
    }
}
